<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Index Events To DynamoDB · Automated Cloud Advisor</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="![alt-text](/pages/disneystreaming/automated-cloud-advisor/img/index_data.png)"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Index Events To DynamoDB · Automated Cloud Advisor"/><meta property="og:type" content="website"/><meta property="og:url" content="https://github.com/pages/disneystreaming/pages/disneystreaming/automated-cloud-advisor/"/><meta property="og:description" content="![alt-text](/pages/disneystreaming/automated-cloud-advisor/img/index_data.png)"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://github.com/pages/disneystreaming/pages/disneystreaming/automated-cloud-advisor/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/pages/disneystreaming/automated-cloud-advisor/img/favicon.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/pages/disneystreaming/automated-cloud-advisor/js/scrollSpy.js"></script><link rel="stylesheet" href="/pages/disneystreaming/automated-cloud-advisor/css/main.css"/><script src="/pages/disneystreaming/automated-cloud-advisor/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/pages/disneystreaming/automated-cloud-advisor/"><img class="logo" src="/pages/disneystreaming/automated-cloud-advisor/img/dss_icon.svg" alt="Automated Cloud Advisor"/><h2 class="headerTitleWithLogo">Automated Cloud Advisor</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/pages/disneystreaming/automated-cloud-advisor/docs/start" target="_self">Docs</a></li><li class=""><a href="https://github.com/disneystreaming/automated-cloud-advisor" target="_blank">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Build Infrastructure</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Getting Started</h3><ul class=""><li class="navListItem"><a class="navItem" href="/pages/disneystreaming/automated-cloud-advisor/docs/start">Getting Started</a></li><li class="navListItem"><a class="navItem" href="/pages/disneystreaming/automated-cloud-advisor/docs/setup">Prerequisites</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Build Infrastructure</h3><ul class=""><li class="navListItem"><a class="navItem" href="/pages/disneystreaming/automated-cloud-advisor/docs/refresh">Schedule Trusted Advisor Refresh</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/pages/disneystreaming/automated-cloud-advisor/docs/">Index Events To DynamoDB</a></li><li class="navListItem"><a class="navItem" href="/pages/disneystreaming/automated-cloud-advisor/docs/stream">Stream Index To ElasticSearch</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Build Dashboard</h3><ul class=""><li class="navListItem"><a class="navItem" href="/pages/disneystreaming/automated-cloud-advisor/docs/view">Kibana</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Index Events To DynamoDB</h1></header><article><div><span><p><img src="/pages/disneystreaming/automated-cloud-advisor/img/index_data.png" alt="alt-text"></p>
<p>This stack will automate the process for parsing the Trusted Advisor data and storing on the DynamoDB index.</p>
<h2><a class="anchor" aria-hidden="true" id="resources"></a><a href="#resources" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Resources</h2>
<p>Here are the types of the various AWS resources created by this stack.</p>
<pre><code class="hljs css language-yml"><span class="hljs-attr">Rule:</span> <span class="hljs-string">AWS::Events::Rule</span>
<span class="hljs-attr">Lambda:</span> <span class="hljs-string">AWS::Lambda::Function</span>
<span class="hljs-attr">DynamoDB:</span> <span class="hljs-string">AWS::DynamoDB::Table</span>
<span class="hljs-attr">Policy:</span> <span class="hljs-string">AWS::IAM::ManagedPolicy</span>
<span class="hljs-attr">Role:</span> <span class="hljs-string">AWS::IAM::Role</span>
<span class="hljs-attr">PermissionForEventsToInvokeLambda:</span> <span class="hljs-string">AWS::Lambda::Permission</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="event-rule"></a><a href="#event-rule" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Event Rule</h3>
<p>CloudWatch can be used to look for specific events based on patterns, and send them to AWS lambdas. In this case, the pattern that is sought is the invocation of Trusted Advisor's <code>refreshTrustedAdvisorCheck</code> function, which triggers a lambda that stores cost-utilization data into a DynamoDB table for later analysis or processing.</p>
<pre><code class="hljs css language-yml"><span class="hljs-attr">EventPattern:</span>
    <span class="hljs-attr">source:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">aws.trustedadvisor</span>
    <span class="hljs-attr">detail-type:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">Trusted</span> <span class="hljs-string">Advisor</span> <span class="hljs-string">Check</span> <span class="hljs-string">Item</span> <span class="hljs-string">Refresh</span> <span class="hljs-string">Notification</span>
    <span class="hljs-attr">detail:</span>
        <span class="hljs-attr">status:</span>
            <span class="hljs-bullet">-</span> <span class="hljs-string">WARN</span>
        <span class="hljs-attr">check-name:</span>
            <span class="hljs-bullet">-</span> <span class="hljs-string">Amazon</span> <span class="hljs-string">RDS</span> <span class="hljs-string">Idle</span> <span class="hljs-string">DB</span> <span class="hljs-string">Instances</span>
            <span class="hljs-bullet">-</span> <span class="hljs-string">Low</span> <span class="hljs-string">Utilization</span> <span class="hljs-string">Amazon</span> <span class="hljs-string">EC2</span> <span class="hljs-string">Instances</span>
            <span class="hljs-bullet">-</span> <span class="hljs-string">Underutilized</span> <span class="hljs-string">Amazon</span> <span class="hljs-string">EBS</span> <span class="hljs-string">Volumes</span>
            <span class="hljs-bullet">-</span> <span class="hljs-string">Unassociated</span> <span class="hljs-string">Elastic</span> <span class="hljs-string">IP</span> <span class="hljs-string">Addresses</span>
            <span class="hljs-bullet">-</span> <span class="hljs-string">Idle</span> <span class="hljs-string">Load</span> <span class="hljs-string">Balancers</span>
            <span class="hljs-bullet">-</span> <span class="hljs-string">Underutilized</span> <span class="hljs-string">Amazon</span> <span class="hljs-string">Redshift</span> <span class="hljs-string">Clusters</span>
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="permission"></a><a href="#permission" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Permission</h4>
<p>The event needs permissions to invoke the Lambda.</p>
<pre><code class="hljs css language-yml"><span class="hljs-attr">PermissionForEventsToInvokeLambda:</span> <span class="hljs-string">AWS::Lambda::Permission</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="lambda"></a><a href="#lambda" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Lambda</h3>
<p>The Lambda parses the event, maps it to a workable schema, and invokes DynamoDB's <code>putItem</code> API.</p>
<pre><code class="hljs css language-js"><span class="hljs-keyword">const</span> params = {
    <span class="hljs-attr">TableName</span>: process.env.DB_NAME,
    Item
};
<span class="hljs-keyword">await</span> dynamodb.putItem(params).promise();
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="permission-1"></a><a href="#permission-1" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Permission</h4>
<h5><a class="anchor" aria-hidden="true" id="logs"></a><a href="#logs" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Logs</h5>
<p>The Lambda needs IAM credentials to execute a few actions:</p>
<pre><code class="hljs css language-yml"><span class="hljs-attr">Effect:</span> <span class="hljs-string">Allow</span>
<span class="hljs-attr">Action:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">logs:CreateLogGroup</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">logs:CreateLogStream</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">logs:PutLogEvents</span>
<span class="hljs-attr">Resource:</span> <span class="hljs-string">'*'</span>
</code></pre>
<h5><a class="anchor" aria-hidden="true" id="dynamodb"></a><a href="#dynamodb" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Dynamodb</h5>
<p>The Lambda needs IAM credentials to call upon DynamoDB's <code>PutItem</code> operation.</p>
<pre><code class="hljs css language-yml"><span class="hljs-attr">Effect:</span> <span class="hljs-string">Allow</span>
<span class="hljs-attr">Action:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">dynamodb:PutItem</span>
<span class="hljs-attr">Resource:</span> <span class="hljs-string">'*'</span>
</code></pre>
<h5><a class="anchor" aria-hidden="true" id="kms"></a><a href="#kms" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>KMS</h5>
<p>The Lambda needs IAM credentials to execute the KMS' <code>Decrypt</code> operation, in order to decipher encrypted environment variables.</p>
<pre><code class="hljs css language-yml"><span class="hljs-attr">Effect:</span> <span class="hljs-string">Allow</span>
<span class="hljs-attr">Action:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">kms:Decrypt</span>
<span class="hljs-attr">Resource:</span> <span class="hljs-string">'*'</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="dynamodb-1"></a><a href="#dynamodb-1" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>DynamoDB</h3>
<p>This NoSQL database is used to index the data coming from Trusted Advisor</p>
<h4><a class="anchor" aria-hidden="true" id="keys"></a><a href="#keys" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Keys</h4>
<pre><code class="hljs css language-yml"><span class="hljs-attr">AttributeDefinitions:</span>
    <span class="hljs-bullet">-</span>
        <span class="hljs-attr">AttributeName:</span> <span class="hljs-string">id</span>
        <span class="hljs-attr">AttributeType:</span> <span class="hljs-string">S</span>
<span class="hljs-attr">KeySchema:</span>
    <span class="hljs-bullet">-</span>
        <span class="hljs-attr">AttributeName:</span> <span class="hljs-string">id</span>
        <span class="hljs-attr">KeyType:</span> <span class="hljs-string">HASH</span>
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="dynamodb-stream"></a><a href="#dynamodb-stream" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>DynamoDB Stream</h4>
<p>Whenever a record is inserted to (or deleted from) DynamoDB, a corresponding event is sent to a lambda, which receives them in batches. This lambda removes stale data from elastic search.</p>
<h5><a class="anchor" aria-hidden="true" id="insert"></a><a href="#insert" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Insert</h5>
<p>An Insert event is triggered whenever DynamoDB's <code>putItem</code> operation is invoked.</p>
<pre><code class="hljs css language-yml"><span class="hljs-attr">StreamSpecification:</span>
    <span class="hljs-attr">StreamViewType:</span> <span class="hljs-string">NEW_IMAGE</span>
</code></pre>
<h5><a class="anchor" aria-hidden="true" id="remove"></a><a href="#remove" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Remove</h5>
<p>A Remove event is triggered whenever the record expires. The expiration date of a record is materialized by the presence of a <code>TTL</code> (time-to-live) field in it.</p>
<pre><code class="hljs css language-yml"><span class="hljs-attr">TimeToLiveSpecification:</span>
    <span class="hljs-attr">AttributeName:</span> <span class="hljs-string">ttl</span>
    <span class="hljs-attr">Enabled:</span> <span class="hljs-literal">true</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="parameters"></a><a href="#parameters" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Parameters</h2>
<h3><a class="anchor" aria-hidden="true" id="required"></a><a href="#required" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Required</h3>
<pre><code class="hljs css language-yml"><span class="hljs-attr">ResourcePrefix:</span> <span class="hljs-string">String</span>
    <span class="hljs-attr">Description:</span> <span class="hljs-string">Prefix</span> <span class="hljs-string">that</span> <span class="hljs-string">will</span> <span class="hljs-string">be</span> <span class="hljs-string">added</span> <span class="hljs-string">to</span> <span class="hljs-string">all</span> <span class="hljs-string">resources</span>
<span class="hljs-attr">ResourceName:</span> <span class="hljs-string">String</span>
    <span class="hljs-attr">Description:</span> <span class="hljs-string">Name</span> <span class="hljs-string">that</span> <span class="hljs-string">will</span> <span class="hljs-string">be</span> <span class="hljs-string">added</span> <span class="hljs-string">to</span> <span class="hljs-string">all</span> <span class="hljs-string">resources</span>
<span class="hljs-attr">S3_BUCKET:</span> <span class="hljs-string">String</span>
    <span class="hljs-attr">Description:</span> <span class="hljs-string">S3</span> <span class="hljs-string">bucket</span> <span class="hljs-string">reference</span>
<span class="hljs-attr">S3KeyStream:</span> <span class="hljs-string">String</span>
    <span class="hljs-attr">Description:</span> <span class="hljs-string">S3</span> <span class="hljs-string">key</span> <span class="hljs-string">reference</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="outputs"></a><a href="#outputs" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Outputs</h2>
<pre><code class="hljs css language-yml"><span class="hljs-attr">PolicyArn:</span> <span class="hljs-string">Policy</span> <span class="hljs-string">Arn</span>
<span class="hljs-attr">RoleName:</span> <span class="hljs-string">Role</span> <span class="hljs-string">Name</span>
<span class="hljs-attr">RoleArn:</span> <span class="hljs-string">Role</span> <span class="hljs-string">Arn</span>
<span class="hljs-attr">RoleId:</span> <span class="hljs-string">Role</span> <span class="hljs-string">Id</span>
<span class="hljs-attr">LambdaName:</span> <span class="hljs-string">Lambda</span> <span class="hljs-string">Name</span>
<span class="hljs-attr">LambdaArn:</span> <span class="hljs-string">Lambda</span> <span class="hljs-string">Arn</span>
<span class="hljs-attr">RuleArn:</span> <span class="hljs-string">Rule</span> <span class="hljs-string">Arn</span>
<span class="hljs-attr">DynamoDBName:</span> <span class="hljs-string">DynamoDB</span> <span class="hljs-string">Name</span>
<span class="hljs-attr">DynamoDBArn:</span> <span class="hljs-string">DynamoDB</span> <span class="hljs-string">Arn</span>
<span class="hljs-attr">DynamoDBStreamArn:</span> <span class="hljs-string">DynamoDB</span> <span class="hljs-string">Stream</span> <span class="hljs-string">Arn</span>
    <span class="hljs-attr">Export:</span> <span class="hljs-type">!Sub</span> <span class="hljs-string">'${AWS::StackName}-StreamArn'</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="cli"></a><a href="#cli" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CLI</h2>
<pre><code class="hljs css language-bash"><span class="hljs-comment"># Optional - You will need a valid way of authenticating with the CLI</span>
<span class="hljs-comment"># aws cloudformation create-stack --profile $PROFILE --region us-east-1 ...</span>
<span class="hljs-built_in">export</span> PROFILE=<span class="hljs-built_in">test</span>-profile
<span class="hljs-comment"># Required</span>
<span class="hljs-built_in">export</span> PREFIX=team-name
<span class="hljs-built_in">export</span> INDEX_NAME=aca-index
<span class="hljs-built_in">export</span> S3_BUCKET=<span class="hljs-built_in">test</span>-bucket
<span class="hljs-built_in">export</span> S3_KEY_INDEX=index.zip

<span class="hljs-built_in">pushd</span> src
    zip -X <span class="hljs-variable">$S3_KEY_INDEX</span> index.js
    aws s3 cp \
        <span class="hljs-variable">$S3_KEY_INDEX</span> s3://<span class="hljs-variable">$S3_BUCKET</span>
    rm -rf <span class="hljs-variable">$S3_KEY_INDEX</span>
<span class="hljs-built_in">popd</span>

INDEX_STACK=$(aws cloudformation \
    create-stack \
    --region us-east-1 \
    --stack-name <span class="hljs-variable">$PREFIX</span>-<span class="hljs-variable">$INDEX_NAME</span> \
    --template-body file://aws/index.yml \
    --capabilities CAPABILITY_NAMED_IAM \
    --parameters ParameterKey=ResourcePrefix,ParameterValue=<span class="hljs-variable">$PREFIX</span> \
    ParameterKey=ResourceName,ParameterValue=<span class="hljs-variable">$INDEX_NAME</span> \
    ParameterKey=S3Bucket,ParameterValue=<span class="hljs-variable">$S3_BUCKET</span> \
    ParameterKey=S3KeyIndex,ParameterValue=<span class="hljs-variable">$S3_KEY_INDEX</span> | jq <span class="hljs-string">'.StackId'</span> | tr -d <span class="hljs-string">'"'</span>)

<span class="hljs-built_in">echo</span> Building Index Stack <span class="hljs-variable">$PREFIX</span>-<span class="hljs-variable">$INDEX_NAME</span>

aws cloudformation <span class="hljs-built_in">wait</span> \
    stack-create-complete \
    --stack-name <span class="hljs-variable">$INDEX_STACK</span>

<span class="hljs-built_in">echo</span> Index Stack has been deployed!
</code></pre>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/pages/disneystreaming/automated-cloud-advisor/docs/refresh"><span class="arrow-prev">← </span><span>Schedule Trusted Advisor Refresh</span></a><a class="docs-next button" href="/pages/disneystreaming/automated-cloud-advisor/docs/stream"><span class="function-name-prevnext">Stream Index To ElasticSearch</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#resources">Resources</a><ul class="toc-headings"><li><a href="#event-rule">Event Rule</a></li><li><a href="#lambda">Lambda</a></li><li><a href="#dynamodb-1">DynamoDB</a></li></ul></li><li><a href="#parameters">Parameters</a><ul class="toc-headings"><li><a href="#required">Required</a></li></ul></li><li><a href="#outputs">Outputs</a></li><li><a href="#cli">CLI</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/pages/disneystreaming/automated-cloud-advisor/" class="nav-home"><img src="/pages/disneystreaming/automated-cloud-advisor/img/dss_icon.svg" alt="Automated Cloud Advisor" width="66" height="58"/></a><div><h5>Docs</h5><a href="/pages/disneystreaming/automated-cloud-advisor/docs/start">Getting Started</a><a href="/pages/disneystreaming/automated-cloud-advisor/docs/refresh">Trusted Advisor</a><a href="/pages/disneystreaming/automated-cloud-advisor/docs/index">DynamoDB</a><a href="/pages/disneystreaming/automated-cloud-advisor/docs/stream">Elastic Search</a><a href="/pages/disneystreaming/automated-cloud-advisor/docs/view">Kibana</a></div><div><h5>Community</h5><a href="https://www.disneystreaming.com" target="_blank">Disney Streaming</a><a href="https://twitter.com/disneystreaming" target="_blank" rel="noreferrer noopener">Twitter</a></div><div><h5>More</h5><a href="https://github.com/disneystreaming" target="_blank">GitHub</a><a class="github-button" href="https://github.com/disneystreaming/automated-cloud-advisor" data-icon="octicon-star" data-count-href="/disneystreaming/automated-cloud-advisor/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a><div class="social"><a href="https://twitter.com/disneystreaming" class="twitter-follow-button">Follow @disneystreaming</a></div></div></section><a href="https://www.disneystreaming.com" target="_blank" rel="noreferrer noopener" class="fbOpenSource"><img src="/pages/disneystreaming/automated-cloud-advisor/img/dss_logo.svg" alt="Disney Streaming Open Source" width="204" height="54"/></a><section class="copyright">Copyright © 2020 Disney Streaming Services</section></footer></div><script>window.twttr=(function(d,s, id){var js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(id))return t;js=d.createElement(s);js.id=id;js.src='https://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js, fjs);t._e = [];t.ready = function(f) {t._e.push(f);};return t;}(document, 'script', 'twitter-wjs'));</script></body></html>